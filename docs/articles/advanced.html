<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Advanced Topics • corrselect</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Advanced Topics">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">corrselect</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/quickstart.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/quickstart.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="../articles/workflows.html">Workflows</a></li>
    <li><a class="dropdown-item" href="../articles/comparison.html">Comparison</a></li>
    <li><a class="dropdown-item" href="../articles/advanced.html">Advanced</a></li>
    <li><a class="dropdown-item" href="../articles/theory.html">Theory</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gcol33/corrselect" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Advanced Topics</h1>
                        <h4 data-toc-skip class="author">Gilles
Colling</h4>
            
            <h4 data-toc-skip class="date">2025-12-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gcol33/corrselect/blob/HEAD/vignettes/advanced.Rmd" class="external-link"><code>vignettes/advanced.Rmd</code></a></small>
      <div class="d-none name"><code>advanced.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>This vignette covers advanced topics for power users, researchers,
and method developers:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Understanding the Algorithms</strong> - Exact vs greedy,
complexity analysis</li>
<li>
<strong>Custom Engines</strong> - Integrate any modeling package
(INLA, mgcv, brms)</li>
<li>
<strong>Exact Subset Enumeration</strong> - Multiple maximal
subsets</li>
<li>
<strong>Performance Optimization</strong> - Speed and memory
considerations</li>
<li>
<strong>Troubleshooting</strong> - Common issues and solutions</li>
</ol>
<p><strong>Target audience</strong>: Users comfortable with R
programming and statistical methods</p>
<p><strong>Estimated time</strong>: 15-20 minutes</p>
<hr>
</div>
<div class="section level2">
<h2 id="understanding-the-algorithms">1. Understanding the Algorithms<a class="anchor" aria-label="anchor" href="#understanding-the-algorithms"></a>
</h2>
<div class="section level3">
<h3 id="exact-vs-greedy-when-to-use-each">1.1 Exact vs Greedy: When to Use Each<a class="anchor" aria-label="anchor" href="#exact-vs-greedy-when-to-use-each"></a>
</h3>
<p>corrselect offers two algorithmic approaches for
<code><a href="../reference/corrPrune.html">corrPrune()</a></code>:</p>
<div class="section level4">
<h4 id="exact-mode-graph-theoretic">Exact Mode (Graph-Theoretic)<a class="anchor" aria-label="anchor" href="#exact-mode-graph-theoretic"></a>
</h4>
<p><strong>Algorithm</strong>: Eppstein–Löffler–Strash (ELS) or
Bron–Kerbosch <strong>Complexity</strong>: O(2^p) - exponential in
number of predictors <strong>Guarantee</strong>: Finds the
<strong>largest</strong> maximal independent set</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Exact mode: guaranteed optimal</span></span>
<span><span class="va">exact_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">mtcars</span>, threshold <span class="op">=</span> <span class="fl">0.7</span>, mode <span class="op">=</span> <span class="st">"exact"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Exact mode kept:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">exact_result</span><span class="op">)</span>, <span class="st">"variables\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Exact mode kept: 5 variables</span></span></code></pre></div>
<p><strong>Use exact mode when</strong>:</p>
<ul>
<li>p ≤ 20 (feasible runtime)</li>
<li>You need guaranteed optimal solution</li>
<li>Reproducibility is critical</li>
<li>You’re writing a paper (justify optimality)</li>
</ul>
</div>
<div class="section level4">
<h4 id="greedy-mode-heuristic">Greedy Mode (Heuristic)<a class="anchor" aria-label="anchor" href="#greedy-mode-heuristic"></a>
</h4>
<p><strong>Algorithm</strong>: Deterministic iterative removal
<strong>Complexity</strong>: O(p² × k) where k = iterations
<strong>Guarantee</strong>: Near-optimal, deterministic</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Greedy mode: fast approximation</span></span>
<span><span class="va">greedy_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">mtcars</span>, threshold <span class="op">=</span> <span class="fl">0.7</span>, mode <span class="op">=</span> <span class="st">"greedy"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Greedy mode kept:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">greedy_result</span><span class="op">)</span>, <span class="st">"variables\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Greedy mode kept: 5 variables</span></span></code></pre></div>
<p><strong>Use greedy mode when</strong>:</p>
<ul>
<li>p &gt; 20 (exact becomes slow)</li>
<li>Speed is priority</li>
<li>Near-optimal is acceptable</li>
<li>High-dimensional data (p &gt; 100)</li>
</ul>
</div>
<div class="section level4">
<h4 id="auto-mode-recommended">Auto Mode (Recommended)<a class="anchor" aria-label="anchor" href="#auto-mode-recommended"></a>
</h4>
<p>Automatically selects based on p:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Auto mode: smart switching (exact if p ≤ 20, greedy otherwise)</span></span>
<span><span class="va">auto_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">mtcars</span>, threshold <span class="op">=</span> <span class="fl">0.7</span>, mode <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Auto mode kept:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">auto_result</span><span class="op">)</span>, <span class="st">"variables\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Auto mode kept: 5 variables</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="complexity-analysis-with-benchmarks">1.2 Complexity Analysis with Benchmarks<a class="anchor" aria-label="anchor" href="#complexity-analysis-with-benchmarks"></a>
</h3>
<p>Let’s measure runtime scaling:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate datasets with increasing p</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/" class="external-link">microbenchmark</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">benchmark_corrPrune</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p_values</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    exact_time_ms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    greedy_time_ms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="va">p_values</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Generate correlated data</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span>    <span class="va">cor_mat</span> <span class="op">&lt;-</span> <span class="fl">0.5</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">p</span>, <span class="fl">1</span><span class="op">:</span><span class="va">p</span>, <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">p</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">cor_mat</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Exact mode (skip if p too large)</span></span>
<span>    <span class="va">exact_time_ms</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">p</span> <span class="op">&lt;=</span> <span class="fl">500</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">data</span>, threshold <span class="op">=</span> <span class="fl">0.7</span>, mode <span class="op">=</span> <span class="st">"exact"</span><span class="op">)</span>,</span>
<span>        times <span class="op">=</span> <span class="fl">3</span>,  <span class="co"># Few iterations for speed</span></span>
<span>        unit <span class="op">=</span> <span class="st">"ms"</span></span>
<span>      <span class="op">)</span><span class="op">$</span><span class="va">time</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1e6</span>  <span class="co"># Convert nanoseconds to milliseconds</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="cn">NA</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Greedy mode</span></span>
<span>    <span class="va">greedy_time_ms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">data</span>, threshold <span class="op">=</span> <span class="fl">0.7</span>, mode <span class="op">=</span> <span class="st">"greedy"</span><span class="op">)</span>,</span>
<span>      times <span class="op">=</span> <span class="fl">3</span>,  <span class="co"># Few iterations for speed</span></span>
<span>      unit <span class="op">=</span> <span class="st">"ms"</span></span>
<span>    <span class="op">)</span><span class="op">$</span><span class="va">time</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1e6</span>  <span class="co"># Convert nanoseconds to milliseconds</span></span>
<span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">results</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      p <span class="op">=</span> <span class="va">p</span>,</span>
<span>      exact_time_ms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">exact_time_ms</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      greedy_time_ms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">greedy_time_ms</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">results</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Benchmark (extended range to show comprehensive scaling behavior)</span></span>
<span><span class="va">p_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">300</span>, <span class="fl">500</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">benchmark</span> <span class="op">&lt;-</span> <span class="fu">benchmark_corrPrune</span><span class="op">(</span><span class="va">p_values</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">benchmark</span><span class="op">)</span></span>
<span><span class="co">#&gt;      p exact_time_ms greedy_time_ms</span></span>
<span><span class="co">#&gt; 1   10           0.8            0.8</span></span>
<span><span class="co">#&gt; 2   20           1.2            0.7</span></span>
<span><span class="co">#&gt; 3   50           2.2            1.5</span></span>
<span><span class="co">#&gt; 4  100           6.9            2.6</span></span>
<span><span class="co">#&gt; 5  200          29.3            5.6</span></span>
<span><span class="co">#&gt; 6  300         104.1           11.9</span></span>
<span><span class="co">#&gt; 7  500         364.8           25.8</span></span>
<span><span class="co">#&gt; 8 1000            NA          101.3</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize scaling</span></span>
<span><span class="co"># Separate data for exact mode (only where available) and greedy mode (all points)</span></span>
<span><span class="va">exact_valid</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">benchmark</span><span class="op">$</span><span class="va">exact_time_ms</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">benchmark</span><span class="op">$</span><span class="va">exact_time_ms</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span><span class="va">greedy_valid</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">benchmark</span><span class="op">$</span><span class="va">greedy_time_ms</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">benchmark</span><span class="op">$</span><span class="va">greedy_time_ms</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Replace any zeros with small positive value for log scale</span></span>
<span><span class="va">exact_times</span> <span class="op">&lt;-</span> <span class="va">benchmark</span><span class="op">$</span><span class="va">exact_time_ms</span></span>
<span><span class="va">greedy_times</span> <span class="op">&lt;-</span> <span class="va">benchmark</span><span class="op">$</span><span class="va">greedy_time_ms</span></span>
<span><span class="va">exact_times</span><span class="op">[</span><span class="va">exact_times</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">exact_times</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span>
<span><span class="va">greedy_times</span><span class="op">[</span><span class="va">greedy_times</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">greedy_times</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span>
<span></span>
<span><span class="co"># Determine y-axis limits from valid data</span></span>
<span><span class="va">all_valid_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">exact_times</span><span class="op">[</span><span class="va">exact_valid</span><span class="op">]</span>, <span class="va">greedy_times</span><span class="op">[</span><span class="va">greedy_valid</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">all_valid_times</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">all_valid_times</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot greedy mode (all points)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">benchmark</span><span class="op">$</span><span class="va">p</span><span class="op">[</span><span class="va">greedy_valid</span><span class="op">]</span>, <span class="va">greedy_times</span><span class="op">[</span><span class="va">greedy_valid</span><span class="op">]</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"b"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">19</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Number of Predictors (p)"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Time (milliseconds, log scale)"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Exact vs Greedy Scaling"</span>,</span>
<span>     ylim <span class="op">=</span> <span class="va">ylim</span>,</span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">benchmark</span><span class="op">$</span><span class="va">p</span><span class="op">)</span>,</span>
<span>     log <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add exact mode (only where available)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">benchmark</span><span class="op">$</span><span class="va">p</span><span class="op">[</span><span class="va">exact_valid</span><span class="op">]</span>, <span class="va">exact_times</span><span class="op">[</span><span class="va">exact_valid</span><span class="op">]</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"b"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">1</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">19</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mark exact mode limit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">500</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fl">500</span>, <span class="va">ylim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="fl">0.5</span>, <span class="st">"Exact mode limit"</span>, pos <span class="op">=</span> <span class="fl">4</span>, col <span class="op">=</span> <span class="st">"gray30"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Exact"</span>, <span class="st">"Greedy"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>       lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>       bty <span class="op">=</span> <span class="st">"o"</span>,</span>
<span>       bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p>
<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='576.00pt' height='360.00pt' viewBox='0 0 576.00 360.00' class="r-plt inline-svg" style="max-width:100%;width:100%;height:auto;">
<g class='svglite'>
<defs>
  <style type='text/css'><![CDATA[
    /* theme-aware-processed */
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite circle {
      fill: none;
      stroke: #3E3F3A;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite > g > rect {
      fill: none;
      stroke: #3E3F3A;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
      fill: #3E3F3A;
    }
    .svglite g.glyphgroup path {
      fill: inherit;
      stroke: none;
    }
  ]]></style>
</defs>
<rect class='svg-bg' width='100%' height='100%' style='stroke: none; fill: #F5F6F8;'/>
<defs>
  <clipPath id='cpMC4wMHw1NzYuMDB8MC4wMHwzNjAuMDA='>
    <rect x='0.00' y='0.00' width='576.00' height='360.00' />
  </clipPath>
</defs>
<g clip-path='url(#cpMC4wMHw1NzYuMDB8MC4wMHwzNjAuMDA=)'>
</g>
<defs>
  <clipPath id='cpNTkuMDR8NTQ1Ljc2fDU5LjA0fDI4Ni41Ng=='>
    <rect x='59.04' y='59.04' width='486.72' height='227.52' />
  </clipPath>
</defs>
<g clip-path='url(#cpNTkuMDR8NTQ1Ljc2fDU5LjA0fDI4Ni41Ng==)'>
<line x1='85.54' y1='252.99' x2='91.35' y2='244.05' style='stroke-width: 1.50; stroke: #3380CC;' />
<line x1='101.27' y1='234.03' x2='112.04' y2='226.85' style='stroke-width: 1.50; stroke: #3380CC;' />
<line x1='124.57' y1='219.82' x2='157.03' y2='204.74' style='stroke-width: 1.50; stroke: #3380CC;' />
<line x1='170.11' y1='198.71' x2='202.53' y2='183.92' style='stroke-width: 1.50; stroke: #3380CC;' />
<line x1='216.09' y1='179.28' x2='293.11' y2='161.24' style='stroke-width: 1.50; stroke: #3380CC;' />
<line x1='307.23' y1='158.42' x2='520.63' y2='123.07' style='stroke-width: 1.50; stroke: #3380CC;' />
<circle cx='77.07' cy='255.35' r='2.70' style='stroke-width: 1.50; stroke: #3380CC; fill: #3380CC;' />
<circle cx='81.62' cy='259.03' r='2.70' style='stroke-width: 1.50; stroke: #3380CC; fill: #3380CC;' />
<circle cx='95.28' cy='238.02' r='2.70' style='stroke-width: 1.50; stroke: #3380CC; fill: #3380CC;' />
<circle cx='118.04' cy='222.85' r='2.70' style='stroke-width: 1.50; stroke: #3380CC; fill: #3380CC;' />
<circle cx='163.56' cy='201.70' r='2.70' style='stroke-width: 1.50; stroke: #3380CC; fill: #3380CC;' />
<circle cx='209.08' cy='180.93' r='2.70' style='stroke-width: 1.50; stroke: #3380CC; fill: #3380CC;' />
<circle cx='300.12' cy='159.59' r='2.70' style='stroke-width: 1.50; stroke: #3380CC; fill: #3380CC;' />
<circle cx='527.73' cy='121.89' r='2.70' style='stroke-width: 1.50; stroke: #3380CC; fill: #3380CC;' />
</g>
<g clip-path='url(#cpMC4wMHw1NzYuMDB8MC4wMHwzNjAuMDA=)'>
<line x1='72.51' y1='286.56' x2='527.73' y2='286.56' style='stroke-width: 0.75;' />
<line x1='72.51' y1='286.56' x2='72.51' y2='293.76' style='stroke-width: 0.75;' />
<line x1='163.56' y1='286.56' x2='163.56' y2='293.76' style='stroke-width: 0.75;' />
<line x1='254.60' y1='286.56' x2='254.60' y2='293.76' style='stroke-width: 0.75;' />
<line x1='345.65' y1='286.56' x2='345.65' y2='293.76' style='stroke-width: 0.75;' />
<line x1='436.69' y1='286.56' x2='436.69' y2='293.76' style='stroke-width: 0.75;' />
<line x1='527.73' y1='286.56' x2='527.73' y2='293.76' style='stroke-width: 0.75;' />
<text x='72.51' y='312.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='6.67px' lengthAdjust='spacingAndGlyphs'>0</text>
<text x='163.56' y='312.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='20.02px' lengthAdjust='spacingAndGlyphs'>200</text>
<text x='254.60' y='312.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='20.02px' lengthAdjust='spacingAndGlyphs'>400</text>
<text x='345.65' y='312.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='20.02px' lengthAdjust='spacingAndGlyphs'>600</text>
<text x='436.69' y='312.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='20.02px' lengthAdjust='spacingAndGlyphs'>800</text>
<text x='527.73' y='312.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='26.69px' lengthAdjust='spacingAndGlyphs'>1000</text>
<line x1='59.04' y1='268.30' x2='59.04' y2='77.88' style='stroke-width: 0.75;' />
<line x1='59.04' y1='268.30' x2='51.84' y2='268.30' style='stroke-width: 0.75;' />
<line x1='59.04' y1='249.19' x2='51.84' y2='249.19' style='stroke-width: 0.75;' />
<line x1='59.04' y1='230.09' x2='51.84' y2='230.09' style='stroke-width: 0.75;' />
<line x1='59.04' y1='204.83' x2='51.84' y2='204.83' style='stroke-width: 0.75;' />
<line x1='59.04' y1='185.72' x2='51.84' y2='185.72' style='stroke-width: 0.75;' />
<line x1='59.04' y1='166.61' x2='51.84' y2='166.61' style='stroke-width: 0.75;' />
<line x1='59.04' y1='141.36' x2='51.84' y2='141.36' style='stroke-width: 0.75;' />
<line x1='59.04' y1='122.25' x2='51.84' y2='122.25' style='stroke-width: 0.75;' />
<line x1='59.04' y1='103.14' x2='51.84' y2='103.14' style='stroke-width: 0.75;' />
<line x1='59.04' y1='77.88' x2='51.84' y2='77.88' style='stroke-width: 0.75;' />
<text transform='translate(41.76,268.30) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.5</text>
<text transform='translate(41.76,230.09) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>2.0</text>
<text transform='translate(41.76,185.72) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='23.34px' lengthAdjust='spacingAndGlyphs'>10.0</text>
<text transform='translate(41.76,141.36) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='23.34px' lengthAdjust='spacingAndGlyphs'>50.0</text>
<text transform='translate(41.76,103.14) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='30.02px' lengthAdjust='spacingAndGlyphs'>200.0</text>
<polygon points='59.04,286.56 545.76,286.56 545.76,59.04 59.04,59.04 ' style='stroke-width: 0.75;' />
<text x='302.40' y='34.67' text-anchor='middle' style='font-size: 14.40px; font-weight: bold; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='167.16px' lengthAdjust='spacingAndGlyphs'>Exact vs Greedy Scaling</text>
<text x='302.40' y='341.28' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='131.36px' lengthAdjust='spacingAndGlyphs'>Number of Predictors (p)</text>
<text transform='translate(12.96,172.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='156.95px' lengthAdjust='spacingAndGlyphs'>Time (milliseconds, log scale)</text>
</g>
<g clip-path='url(#cpNTkuMDR8NTQ1Ljc2fDU5LjA0fDI4Ni41Ng==)'>
<line x1='86.18' y1='238.59' x2='90.72' y2='233.03' style='stroke-width: 1.50; stroke: #CC3333;' />
<line x1='99.49' y1='221.62' x2='113.82' y2='201.79' style='stroke-width: 1.50; stroke: #CC3333;' />
<line x1='123.45' y1='191.21' x2='158.14' y2='160.83' style='stroke-width: 1.50; stroke: #CC3333;' />
<line x1='169.27' y1='151.70' x2='203.37' y2='125.53' style='stroke-width: 1.50; stroke: #CC3333;' />
<line x1='215.81' y1='118.59' x2='293.39' y2='89.13' style='stroke-width: 1.50; stroke: #CC3333;' />
<circle cx='77.07' cy='255.35' r='2.70' style='stroke-width: 1.50; stroke: #CC3333; fill: #CC3333;' />
<circle cx='81.62' cy='244.17' r='2.70' style='stroke-width: 1.50; stroke: #CC3333; fill: #CC3333;' />
<circle cx='95.28' cy='227.46' r='2.70' style='stroke-width: 1.50; stroke: #CC3333; fill: #CC3333;' />
<circle cx='118.04' cy='195.95' r='2.70' style='stroke-width: 1.50; stroke: #CC3333; fill: #CC3333;' />
<circle cx='163.56' cy='156.09' r='2.70' style='stroke-width: 1.50; stroke: #CC3333; fill: #CC3333;' />
<circle cx='209.08' cy='121.14' r='2.70' style='stroke-width: 1.50; stroke: #CC3333; fill: #CC3333;' />
<circle cx='300.12' cy='86.57' r='2.70' style='stroke-width: 1.50; stroke: #CC3333; fill: #CC3333;' />
<line x1='300.12' y1='286.56' x2='300.12' y2='59.04' style='stroke-width: 0.75; stroke: #7F7F7F; stroke-dasharray: 4.00,4.00;' />
<text x='307.32' y='89.44' style='font-size: 12.00px;fill: #4D4D4D; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='88.02px' lengthAdjust='spacingAndGlyphs'>Exact mode limit</text>
<rect rx='4' x='59.04' y='59.04' width='80.38' height='43.20' style='stroke-width: 0.75; stroke: #DFD7CA; fill: #F5F6F8;' />
<line x1='62.28' y1='73.44' x2='83.88' y2='73.44' style='stroke-width: 1.50; stroke: #CC3333;' />
<line x1='62.28' y1='87.84' x2='83.88' y2='87.84' style='stroke-width: 1.50; stroke: #3380CC;' />
<circle cx='73.08' cy='73.44' r='2.70' style='stroke-width: 1.50; stroke: #CC3333; fill: #CC3333;' />
<circle cx='73.08' cy='87.84' r='2.70' style='stroke-width: 1.50; stroke: #3380CC; fill: #3380CC;' />
<text x='94.68' y='77.74' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='30.00px' lengthAdjust='spacingAndGlyphs'>Exact</text>
<text x='94.68' y='92.14' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='39.34px' lengthAdjust='spacingAndGlyphs'>Greedy</text>
</g>
</g>
</svg></p>
<p><strong>Key insight</strong>: The scaling behavior depends heavily on
correlation structure. For this moderately correlated dataset (ρ =
0.5^|i-j|), exact mode remains practical up to p ≈ 500, while greedy
mode scales efficiently beyond p = 1000. The exact mode provides
guaranteed optimality at the cost of computational complexity, while
greedy mode offers substantial speed advantages for large p with
near-optimal results in most practical scenarios.</p>
</div>
<div class="section level3">
<h3 id="deterministic-tie-breaking">1.3 Deterministic Tie-Breaking<a class="anchor" aria-label="anchor" href="#deterministic-tie-breaking"></a>
</h3>
<p>When multiple variables have identical correlation profiles,
corrselect uses deterministic tie-breaking:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create data with identical correlations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>  <span class="co"># Almost identical to x1</span></span>
<span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>  <span class="co"># Also almost identical to x1</span></span>
<span><span class="va">x4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>                  <span class="co"># Independent</span></span>
<span></span>
<span><span class="va">data_ties</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span>, <span class="va">x3</span>, <span class="va">x4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run multiple times - always same result</span></span>
<span><span class="va">result1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">data_ties</span>, threshold <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="va">result2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">data_ties</span>, threshold <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Run 1 selected:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result1</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Run 1 selected: x2 x4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Run 2 selected:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Run 2 selected: x2 x4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Identical:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result2</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Identical: TRUE</span></span></code></pre></div>
<p><strong>Tie-breaking rules</strong>: 1. Prefer variables with lower
<strong>mean absolute correlation</strong> with others 2. If still tied,
prefer <strong>lexicographically first</strong> (alphabetical)</p>
<p>This ensures reproducibility across runs, machines, and R
versions.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="custom-engines-for-modelprune">2. Custom Engines for modelPrune()<a class="anchor" aria-label="anchor" href="#custom-engines-for-modelprune"></a>
</h2>
<div class="section level3">
<h3 id="understanding-custom-engines">2.1 Understanding Custom Engines<a class="anchor" aria-label="anchor" href="#understanding-custom-engines"></a>
</h3>
<div class="section level4">
<h4 id="what-is-a-custom-engine">What is a Custom Engine?<a class="anchor" aria-label="anchor" href="#what-is-a-custom-engine"></a>
</h4>
<p>A custom engine allows you to integrate <strong>any</strong> modeling
framework with <code><a href="../reference/modelPrune.html">modelPrune()</a></code>, not just base R’s
<code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> or <code>lme4</code>. This enables VIF-based pruning
for:</p>
<ul>
<li>
<strong>Bayesian models</strong> (INLA, brms, Stan)</li>
<li>
<strong>Additive models</strong> (mgcv GAMs)</li>
<li>
<strong>Survival models</strong> (coxph, flexsurv)</li>
<li>
<strong>Custom metrics</strong> (AIC, BIC, posterior
uncertainty)</li>
</ul>
</div>
<div class="section level4">
<h4 id="how-custom-engines-work">How Custom Engines Work<a class="anchor" aria-label="anchor" href="#how-custom-engines-work"></a>
</h4>
<p>The <code><a href="../reference/modelPrune.html">modelPrune()</a></code> algorithm follows this iterative
process:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Fit</strong> the model with current predictors</li>
<li>
<strong>Diagnose</strong> each predictor (compute a “badness”
metric)</li>
<li>
<strong>Identify</strong> the worst predictor (highest diagnostic
value)</li>
<li>
<strong>Remove</strong> if it exceeds the <code>limit</code>
threshold</li>
<li>
<strong>Repeat</strong> until all predictors satisfy the limit</li>
</ol>
<p>Your custom engine defines steps 1 and 2; <code><a href="../reference/modelPrune.html">modelPrune()</a></code>
handles the iteration logic.</p>
</div>
<div class="section level4">
<h4 id="engine-structure-requirements">Engine Structure Requirements<a class="anchor" aria-label="anchor" href="#engine-structure-requirements"></a>
</h4>
<p>A custom engine is a named list with two required functions:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_engine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># Required: How to fit the model</span></span>
<span>  fit <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Your model fitting code</span></span>
<span>    <span class="co"># Must return a fitted model object</span></span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  <span class="co"># Required: How to compute diagnostics</span></span>
<span>  diagnostics <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">fixed_effects</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Compute diagnostic scores for each fixed effect</span></span>
<span>    <span class="co"># Higher values = worse (more likely to be removed)</span></span>
<span>    <span class="co"># Must return a named numeric vector</span></span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  <span class="co"># Optional: Name for error messages</span></span>
<span>  name <span class="op">=</span> <span class="st">"my_custom_engine"</span>  <span class="co"># Defaults to "custom"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Key principle</strong>: The <code>diagnostics</code> function
must return <strong>higher values for worse predictors</strong>. This
inverted metric ensures the algorithm removes the most problematic
variables first.</p>
</div>
</div>
<div class="section level3">
<h3 id="example-inla-engine-bayesian-spatial-models">2.2 Example: INLA Engine (Bayesian Spatial Models)<a class="anchor" aria-label="anchor" href="#example-inla-engine-bayesian-spatial-models"></a>
</h3>
<div class="section level4">
<h4 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h4>
<p>INLA (Integrated Nested Laplace Approximations) is a popular package
for fast Bayesian inference, especially for spatial and temporal models.
Unlike traditional VIF, we can use <strong>posterior
uncertainty</strong> as a pruning criterion: variables with high
posterior standard deviation contribute less information to the
model.</p>
</div>
<div class="section level4">
<h4 id="implementation">Implementation<a class="anchor" aria-label="anchor" href="#implementation"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Custom engine for INLA</span></span>
<span><span class="va">inla_engine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"inla"</span>,</span>
<span></span>
<span>  fit <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Fit INLA model</span></span>
<span>    <span class="fu">INLA</span><span class="fu">::</span><span class="fu">inla</span><span class="op">(</span></span>
<span>      formula <span class="op">=</span> <span class="va">formula</span>,</span>
<span>      data <span class="op">=</span> <span class="va">data</span>,</span>
<span>      family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">$</span><span class="va">family</span> <span class="op"><a href="https://rdrr.io/r/base/Control.html" class="external-link">%||%</a></span> <span class="st">"gaussian"</span>,</span>
<span>      control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>config <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      <span class="va">...</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  diagnostics <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">fixed_effects</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Use posterior SD as "badness" metric</span></span>
<span>    <span class="co"># Higher SD = more uncertain = candidate for removal</span></span>
<span>    <span class="va">summary_fixed</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">summary.fixed</span></span>
<span>    <span class="va">scores</span> <span class="op">&lt;-</span> <span class="va">summary_fixed</span><span class="op">[</span>, <span class="st">"sd"</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">summary_fixed</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Return scores for fixed effects only</span></span>
<span>    <span class="va">scores</span><span class="op">[</span><span class="va">fixed_effects</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Usage example</span></span>
<span><span class="va">pruned</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelPrune.html">modelPrune</a></span><span class="op">(</span></span>
<span>  <span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span>,</span>
<span>  data <span class="op">=</span> <span class="va">my_data</span>,</span>
<span>  engine <span class="op">=</span> <span class="va">inla_engine</span>,</span>
<span>  limit <span class="op">=</span> <span class="fl">0.5</span>  <span class="co"># Remove if posterior SD &gt; 0.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="how-it-works">How It Works<a class="anchor" aria-label="anchor" href="#how-it-works"></a>
</h4>
<ol style="list-style-type: decimal">
<li>
<strong>fit</strong>: Calls <code>INLA::inla()</code> to compute
posterior distributions</li>
<li>
<strong>diagnostics</strong>: Extracts posterior standard deviations
from <code>model$summary.fixed</code>
</li>
<li>
<strong>limit</strong>: Threshold for acceptable uncertainty (e.g.,
0.5 means remove predictors with posterior SD &gt; 0.5)</li>
</ol>
<p><strong>Interpretation</strong>: Variables with high posterior SD
have coefficients that are uncertain given the data. Removing them
reduces model complexity without losing much information.</p>
<p><strong>When to use</strong>: Spatial models, hierarchical models,
disease mapping, ecological modeling with INLA.</p>
</div>
</div>
<div class="section level3">
<h3 id="example-mgcv-engine-gams">2.3 Example: mgcv Engine (GAMs)<a class="anchor" aria-label="anchor" href="#example-mgcv-engine-gams"></a>
</h3>
<div class="section level4">
<h4 id="background-1">Background<a class="anchor" aria-label="anchor" href="#background-1"></a>
</h4>
<p>Generalized Additive Models (GAMs) allow non-linear relationships via
smooth terms. When pruning GAMs, we want to remove <strong>parametric
(linear) terms</strong> with weak evidence while preserving smooth terms
that model non-linear patterns.</p>
</div>
<div class="section level4">
<h4 id="implementation-1">Implementation<a class="anchor" aria-label="anchor" href="#implementation-1"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Custom engine for mgcv GAMs</span></span>
<span><span class="va">mgcv_engine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"mgcv_gam"</span>,</span>
<span></span>
<span>  fit <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">mgcv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  diagnostics <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">fixed_effects</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Use p-values as badness metric</span></span>
<span>    <span class="co"># Higher p-value = less significant = candidate for removal</span></span>
<span>    <span class="va">summary_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Extract parametric term p-values</span></span>
<span>    <span class="va">pvals</span> <span class="op">&lt;-</span> <span class="va">summary_obj</span><span class="op">$</span><span class="va">p.pv</span></span>
<span></span>
<span>    <span class="co"># Return p-values for fixed effects</span></span>
<span>    <span class="va">pvals</span><span class="op">[</span><span class="va">fixed_effects</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Usage example</span></span>
<span><span class="va">pruned</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelPrune.html">modelPrune</a></span><span class="op">(</span></span>
<span>  <span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">x3</span><span class="op">)</span>,  <span class="co"># s() for smooth terms</span></span>
<span>  data <span class="op">=</span> <span class="va">my_data</span>,</span>
<span>  engine <span class="op">=</span> <span class="va">mgcv_engine</span>,</span>
<span>  limit <span class="op">=</span> <span class="fl">0.05</span>  <span class="co"># Remove if p &gt; 0.05</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="how-it-works-1">How It Works<a class="anchor" aria-label="anchor" href="#how-it-works-1"></a>
</h4>
<ol style="list-style-type: decimal">
<li>
<strong>fit</strong>: Calls <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">mgcv::gam()</a></code> to fit the
additive model</li>
<li>
<strong>diagnostics</strong>: Extracts p-values for
<strong>parametric terms only</strong> (not smooth terms)</li>
<li>
<strong>limit</strong>: Significance threshold (e.g., 0.05 for
traditional α = 0.05)</li>
</ol>
<p><strong>Important</strong>: <code><a href="../reference/modelPrune.html">modelPrune()</a></code> only removes
parametric (linear) terms. Smooth terms specified with <code>s()</code>,
<code>te()</code>, etc. are <strong>never removed</strong>
automatically, as they’re part of the model structure.</p>
<p><strong>When to use</strong>: Non-linear regression, ecological
response curves, time series with trends.</p>
</div>
</div>
<div class="section level3">
<h3 id="example-custom-criterion-aic-based">2.4 Example: Custom Criterion (AIC-Based)<a class="anchor" aria-label="anchor" href="#example-custom-criterion-aic-based"></a>
</h3>
<div class="section level4">
<h4 id="background-2">Background<a class="anchor" aria-label="anchor" href="#background-2"></a>
</h4>
<p>Sometimes you want to prune based on <strong>model comparison
metrics</strong> rather than coefficient-level diagnostics. This example
shows how to remove variables that don’t improve model fit according to
AIC.</p>
</div>
<div class="section level4">
<h4 id="implementation-2">Implementation<a class="anchor" aria-label="anchor" href="#implementation-2"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># AIC-based pruning engine</span></span>
<span><span class="va">aic_engine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"aic_pruner"</span>,</span>
<span></span>
<span>  fit <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  diagnostics <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">fixed_effects</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># For each predictor, compute ΔAIC if removed</span></span>
<span>    <span class="va">full_aic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fixed_effects</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">fixed_effects</span></span>
<span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">var</span> <span class="kw">in</span> <span class="va">fixed_effects</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Refit without this variable</span></span>
<span>      <span class="va">reduced_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"~ . -"</span>, <span class="va">var</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">reduced_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">reduced_formula</span>, data <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span>      <span class="co"># ΔAIC: negative means removing improves model</span></span>
<span>      <span class="co"># We negate so "higher = worse" convention holds</span></span>
<span>      <span class="va">scores</span><span class="op">[</span><span class="va">var</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">reduced_model</span><span class="op">)</span> <span class="op">-</span> <span class="va">full_aic</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">scores</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Usage: Remove predictors with ΔAIC &lt; -2 (improve AIC by &gt; 2 when removed)</span></span>
<span><span class="va">pruned</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelPrune.html">modelPrune</a></span><span class="op">(</span></span>
<span>  <span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span>,</span>
<span>  data <span class="op">=</span> <span class="va">my_data</span>,</span>
<span>  engine <span class="op">=</span> <span class="va">aic_engine</span>,</span>
<span>  limit <span class="op">=</span> <span class="op">-</span><span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="how-it-works-2">How It Works<a class="anchor" aria-label="anchor" href="#how-it-works-2"></a>
</h4>
<ol style="list-style-type: decimal">
<li>
<strong>fit</strong>: Standard linear model</li>
<li>
<strong>diagnostics</strong>: For each variable, refit the model
<strong>without</strong> that variable and compute ΔAIC</li>
<li>
<strong>limit</strong>: Threshold for ΔAIC (e.g., -2 means “remove
if AIC improves by more than 2 points”)</li>
</ol>
<p><strong>Key insight</strong>: The score is <strong>negated</strong>
(multiplied by -1) to maintain the “higher is worse” convention. A
variable with score &gt; -2 means removing it would worsen AIC by more
than 2, so it’s kept.</p>
<p><strong>When to use</strong>: Model selection focused on parsimony,
comparing nested models, when VIF isn’t the right metric.</p>
<p><strong>Alternative metrics</strong>: You can adapt this pattern for
BIC, likelihood ratio tests, or any other model comparison
criterion.</p>
</div>
</div>
<div class="section level3">
<h3 id="validation-and-error-handling">2.5 Validation and Error Handling<a class="anchor" aria-label="anchor" href="#validation-and-error-handling"></a>
</h3>
<div class="section level4">
<h4 id="automatic-validation">Automatic Validation<a class="anchor" aria-label="anchor" href="#automatic-validation"></a>
</h4>
<p><code><a href="../reference/modelPrune.html">modelPrune()</a></code> automatically validates custom engines to
catch common errors early:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Invalid engine: missing 'diagnostics'</span></span>
<span><span class="va">bad_engine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  fit <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>  <span class="co"># Missing 'diagnostics'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/modelPrune.html">modelPrune</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span>, engine <span class="op">=</span> <span class="va">bad_engine</span>, limit <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Error:"</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Custom engine missing required fields: diagnostics</span></span>
<span><span class="co">#&gt; Required: 'fit' and 'diagnostics'</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="validation-checklist">Validation Checklist<a class="anchor" aria-label="anchor" href="#validation-checklist"></a>
</h4>
<p>Your custom engine must satisfy these requirements:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Structure</strong>: Named list with <code>fit</code> and
<code>diagnostics</code> functions</li>
<li>
<strong>fit returns model object</strong>: Must return something the
<code>diagnostics</code> function can consume</li>
<li>
<strong>diagnostics returns numeric vector</strong>: No characters,
factors, or other types</li>
<li>
<strong>Correct length</strong>: One diagnostic value per fixed
effect (excluding intercept)</li>
<li>
<strong>Named vector</strong>: Names must match variable names
exactly</li>
<li>
<strong>No missing values</strong>: NA, NaN, or Inf will cause
errors</li>
<li>
<strong>Higher = worse</strong>: Diagnostic values must increase for
more problematic predictors</li>
</ol>
</div>
<div class="section level4">
<h4 id="debugging-tips">Debugging Tips<a class="anchor" aria-label="anchor" href="#debugging-tips"></a>
</h4>
<p>If your custom engine fails, check:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test your fit function in isolation</span></span>
<span><span class="va">test_model</span> <span class="op">&lt;-</span> <span class="va">my_engine</span><span class="op">$</span><span class="fu">fit</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span>, data <span class="op">=</span> <span class="va">my_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">test_model</span><span class="op">)</span>  <span class="co"># Does it work?</span></span>
<span></span>
<span><span class="co"># Test your diagnostics function</span></span>
<span><span class="va">test_diag</span> <span class="op">&lt;-</span> <span class="va">my_engine</span><span class="op">$</span><span class="fu">diagnostics</span><span class="op">(</span><span class="va">test_model</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">test_diag</span><span class="op">)</span>  <span class="co"># Numeric? Named? Correct length?</span></span>
<span></span>
<span><span class="co"># Check that "higher = worse" convention is satisfied</span></span>
<span><span class="co"># The variable with the highest score should be the one you'd remove first</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="exact-subset-enumeration">3. Exact Subset Enumeration<a class="anchor" aria-label="anchor" href="#exact-subset-enumeration"></a>
</h2>
<div class="section level3">
<h3 id="when-you-need-all-maximal-subsets">3.1 When You Need ALL Maximal Subsets<a class="anchor" aria-label="anchor" href="#when-you-need-all-maximal-subsets"></a>
</h3>
<p><code><a href="../reference/corrPrune.html">corrPrune()</a></code> returns a <strong>single</strong> subset.
Sometimes you want <strong>all</strong> maximal subsets:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># corrPrune: Single subset</span></span>
<span><span class="va">single</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">mtcars</span>, threshold <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"corrPrune returned:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">single</span><span class="op">)</span>, <span class="st">"variables\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; corrPrune returned: 5 variables</span></span>
<span></span>
<span><span class="co"># corrSelect: ALL maximal subsets (use higher threshold to ensure subsets exist)</span></span>
<span><span class="va">all_subsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrSelect.html">corrSelect</a></span><span class="op">(</span><span class="va">mtcars</span>, threshold <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">all_subsets</span><span class="op">)</span></span>
<span><span class="co">#&gt; CorrCombo object</span></span>
<span><span class="co">#&gt; -----------------</span></span>
<span><span class="co">#&gt;   Method:      bron-kerbosch</span></span>
<span><span class="co">#&gt;   Correlation: pearson</span></span>
<span><span class="co">#&gt;   Threshold:   0.900</span></span>
<span><span class="co">#&gt;   Subsets:     2 maximal subsets</span></span>
<span><span class="co">#&gt;   Data Rows:   32 used in correlation</span></span>
<span><span class="co">#&gt;   Pivot:       TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Top combinations:</span></span>
<span><span class="co">#&gt;   No.  Variables                          Avg    Max    Size</span></span>
<span><span class="co">#&gt;   ------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   [ 1] mpg, disp, hp, drat, wt, qsec...  0.527  0.888    10</span></span>
<span><span class="co">#&gt;   [ 2] mpg, cyl, hp, drat, wt, qsec,...  0.531  0.868    10</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="exploring-multiple-subsets">3.2 Exploring Multiple Subsets<a class="anchor" aria-label="anchor" href="#exploring-multiple-subsets"></a>
</h3>
<p>When multiple maximal subsets exist, you can explore them:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">all_subsets</span><span class="op">@</span><span class="va">subset_list</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Display first few subsets</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"First few maximal subsets:\n"</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">all_subsets</span><span class="op">@</span><span class="va">subset_list</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"\nSubset %d (avg corr = %.3f):\n"</span>, <span class="va">i</span>, <span class="va">all_subsets</span><span class="op">@</span><span class="va">avg_corr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">" "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">all_subsets</span><span class="op">@</span><span class="va">subset_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Analyze subset characteristics</span></span>
<span>  <span class="va">subset_sizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">all_subsets</span><span class="op">@</span><span class="va">subset_list</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nSubset sizes:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">subset_sizes</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nAverage correlations:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">all_subsets</span><span class="op">@</span><span class="va">avg_corr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"No subsets found at threshold 0.9\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; First few maximal subsets:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Subset 1 (avg corr = 0.527):</span></span>
<span><span class="co">#&gt;   mpg, disp, hp, drat, wt, qsec, vs, am, gear, carb </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Subset 2 (avg corr = 0.531):</span></span>
<span><span class="co">#&gt;   mpg, cyl, hp, drat, wt, qsec, vs, am, gear, carb </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Subset sizes:</span></span>
<span><span class="co">#&gt; subset_sizes</span></span>
<span><span class="co">#&gt; 10 </span></span>
<span><span class="co">#&gt;  2 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average correlations:</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;  0.5269  0.5280  0.5290  0.5290  0.5301  0.5311</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extracting-specific-subsets">3.3 Extracting Specific Subsets<a class="anchor" aria-label="anchor" href="#extracting-specific-subsets"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">all_subsets</span><span class="op">@</span><span class="va">subset_list</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Extract subset with lowest average correlation</span></span>
<span>  <span class="va">best_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">all_subsets</span><span class="op">@</span><span class="va">avg_corr</span><span class="op">)</span></span>
<span>  <span class="va">best_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrSubset.html">corrSubset</a></span><span class="op">(</span><span class="va">all_subsets</span>, <span class="va">mtcars</span>, which <span class="op">=</span> <span class="va">best_idx</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Best subset (lowest avg correlation):\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">best_subset</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Extract subset with most predictors</span></span>
<span>  <span class="va">subset_sizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">all_subsets</span><span class="op">@</span><span class="va">subset_list</span><span class="op">)</span></span>
<span>  <span class="va">largest_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">subset_sizes</span><span class="op">)</span></span>
<span>  <span class="va">largest_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrSubset.html">corrSubset</a></span><span class="op">(</span><span class="va">all_subsets</span>, <span class="va">mtcars</span>, which <span class="op">=</span> <span class="va">largest_idx</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nLargest subset:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">largest_subset</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"No subsets to extract at threshold 0.9\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Best subset (lowest avg correlation):</span></span>
<span><span class="co">#&gt;  [1] "mpg"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear" "carb"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Largest subset:</span></span>
<span><span class="co">#&gt;  [1] "mpg"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear" "carb"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="advanced-domain-specific-subset-selection">3.4 Advanced: Domain-Specific Subset Selection<a class="anchor" aria-label="anchor" href="#advanced-domain-specific-subset-selection"></a>
</h3>
<p>You can define custom criteria for choosing among multiple
subsets:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">all_subsets</span><span class="op">@</span><span class="va">subset_list</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Custom criterion: Prefer subsets with specific variables</span></span>
<span>  <span class="va">preferred_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mpg"</span>, <span class="st">"hp"</span>, <span class="st">"wt"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Compute score: number of preferred variables in each subset</span></span>
<span>  <span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">all_subsets</span><span class="op">@</span><span class="va">subset_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">vars</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">preferred_vars</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">vars</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Select subset with most preferred variables</span></span>
<span>  <span class="va">best_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Subset with most preferred variables (score:"</span>, <span class="va">scores</span><span class="op">[</span><span class="va">best_idx</span><span class="op">]</span>, <span class="st">"):\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">all_subsets</span><span class="op">@</span><span class="va">subset_list</span><span class="op">[[</span><span class="va">best_idx</span><span class="op">]</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Extract as data frame</span></span>
<span>  <span class="va">preferred_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrSubset.html">corrSubset</a></span><span class="op">(</span><span class="va">all_subsets</span>, <span class="va">mtcars</span>, which <span class="op">=</span> <span class="va">best_idx</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">preferred_subset</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"No subsets available for custom selection\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Subset with most preferred variables (score: 3 ):</span></span>
<span><span class="co">#&gt; mpg, disp, hp, drat, wt, qsec, vs, am, gear, carb </span></span>
<span><span class="co">#&gt;                    mpg disp  hp drat    wt  qsec vs am gear carb</span></span>
<span><span class="co">#&gt; Mazda RX4         21.0  160 110 3.90 2.620 16.46  0  1    4    4</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag     21.0  160 110 3.90 2.875 17.02  0  1    4    4</span></span>
<span><span class="co">#&gt; Datsun 710        22.8  108  93 3.85 2.320 18.61  1  1    4    1</span></span>
<span><span class="co">#&gt; Hornet 4 Drive    21.4  258 110 3.08 3.215 19.44  1  0    3    1</span></span>
<span><span class="co">#&gt; Hornet Sportabout 18.7  360 175 3.15 3.440 17.02  0  0    3    2</span></span>
<span><span class="co">#&gt; Valiant           18.1  225 105 2.76 3.460 20.22  1  0    3    1</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="performance-optimization">4. Performance Optimization<a class="anchor" aria-label="anchor" href="#performance-optimization"></a>
</h2>
<div class="section level3">
<h3 id="precomputed-correlation-matrices">4.1 Precomputed Correlation Matrices<a class="anchor" aria-label="anchor" href="#precomputed-correlation-matrices"></a>
</h3>
<p>For repeated pruning with different thresholds, precompute the
correlation matrix:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create larger dataset for meaningful timing comparison</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">large_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fl">50</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Benchmark: Recompute correlation every time</span></span>
<span><span class="va">time1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">result1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">large_data</span>, threshold <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span>    <span class="va">result2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">large_data</span>, threshold <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span>    <span class="va">result3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">large_data</span>, threshold <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  unit <span class="op">=</span> <span class="st">"ms"</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">time</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1e6</span>  <span class="co"># Convert nanoseconds to milliseconds</span></span>
<span></span>
<span><span class="co"># Benchmark: Compute correlation once, reuse</span></span>
<span><span class="va">cor_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">large_data</span><span class="op">)</span></span>
<span><span class="va">time2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">result1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MatSelect.html">MatSelect</a></span><span class="op">(</span><span class="va">cor_matrix</span>, threshold <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span>    <span class="va">result2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MatSelect.html">MatSelect</a></span><span class="op">(</span><span class="va">cor_matrix</span>, threshold <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span>    <span class="va">result3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MatSelect.html">MatSelect</a></span><span class="op">(</span><span class="va">cor_matrix</span>, threshold <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  unit <span class="op">=</span> <span class="st">"ms"</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">time</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1e6</span>  <span class="co"># Convert nanoseconds to milliseconds</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Recomputing each time: %.1f ms\n"</span>, <span class="va">time1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Recomputing each time: 7.0 ms</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Precomputed matrix: %.1f ms\n"</span>, <span class="va">time2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Precomputed matrix: 2.9 ms</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Speedup: %.1fx faster\n"</span>, <span class="va">time1</span> <span class="op">/</span> <span class="va">time2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Speedup: 2.4x faster</span></span></code></pre></div>
<p><strong>Use precomputed matrices when</strong>:</p>
<ul>
<li>Testing multiple thresholds</li>
<li>Cross-validation workflows</li>
<li>Sensitivity analysis</li>
</ul>
</div>
<div class="section level3">
<h3 id="memory-considerations-for-large-data">4.2 Memory Considerations for Large Data<a class="anchor" aria-label="anchor" href="#memory-considerations-for-large-data"></a>
</h3>
<p>For large datasets (n &gt; 10,000, p &gt; 500):</p>
<div class="section level4">
<h4 id="memory-efficient-correlation-computation">Memory-Efficient Correlation Computation<a class="anchor" aria-label="anchor" href="#memory-efficient-correlation-computation"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Standard (memory-intensive for large n)</span></span>
<span><span class="va">cor_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">large_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Memory-efficient alternative (for very large n)</span></span>
<span><span class="co"># Process in chunks if needed</span></span>
<span><span class="va">compute_cor_chunked</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">chunk_size</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>  <span class="va">n_chunks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="va">chunk_size</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Use online algorithm or chunked computation</span></span>
<span>  <span class="co"># (Implementation depends on your data size)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sparse-correlation-matrices">Sparse Correlation Matrices<a class="anchor" aria-label="anchor" href="#sparse-correlation-matrices"></a>
</h4>
<p>If most correlations are low, consider sparse storage:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert to sparse format (requires Matrix package)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org" class="external-link">Matrix</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute correlation</span></span>
<span><span class="va">cor_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Threshold and convert to sparse</span></span>
<span><span class="va">cor_sparse</span> <span class="op">&lt;-</span> <span class="va">cor_mat</span></span>
<span><span class="va">cor_sparse</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">cor_sparse</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>  <span class="co"># Set low correlations to 0</span></span>
<span><span class="va">cor_sparse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/Matrix.html" class="external-link">Matrix</a></span><span class="op">(</span><span class="va">cor_sparse</span>, sparse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Memory savings</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">cor_mat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">cor_sparse</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="parallel-processing-strategies">4.3 Parallel Processing Strategies<a class="anchor" aria-label="anchor" href="#parallel-processing-strategies"></a>
</h3>
<p>For multiple independent pruning operations:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create cluster</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export functions to cluster</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterEvalQ</a></span><span class="op">(</span><span class="va">cl</span>, <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gillescolling.com/corrselect/">corrselect</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Parallel pruning with different thresholds</span></span>
<span><span class="va">thresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.9</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parLapply</a></span><span class="op">(</span><span class="va">cl</span>, <span class="va">thresholds</span>, <span class="kw">function</span><span class="op">(</span><span class="va">thresh</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">my_data</span>, threshold <span class="op">=</span> <span class="va">thresh</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clean up</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span></code></pre></div>
<p><strong>Note</strong>: corrselect itself doesn’t parallelize
internally (for reproducibility), but you can parallelize
<strong>across</strong> multiple analyses.</p>
</div>
<div class="section level3">
<h3 id="choosing-the-right-mode">4.4 Choosing the Right Mode<a class="anchor" aria-label="anchor" href="#choosing-the-right-mode"></a>
</h3>
<p>Decision tree for mode selection:</p>
<pre><code>p ≤ 15:  Use "exact" (fast enough, guaranteed optimal)
15 &lt; p ≤ 25:  Use "exact" if time permits, "greedy" if speed critical
p &gt; 25:  Use "greedy" or "auto"
p &gt; 100: Always use "greedy"</code></pre>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="troubleshooting">5. Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h2>
<div class="section level3">
<h3 id="common-errors-and-solutions">5.1 Common Errors and Solutions<a class="anchor" aria-label="anchor" href="#common-errors-and-solutions"></a>
</h3>
<div class="section level4">
<h4 id="error-no-valid-subsets-found">Error: “No valid subsets found”<a class="anchor" aria-label="anchor" href="#error-no-valid-subsets-found"></a>
</h4>
<p><strong>Cause</strong>: Threshold too strict - all variables exceed
it</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: All correlations &gt; 0.9</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">high_cor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x1 <span class="op">=</span> <span class="va">x</span>,</span>
<span>  x2 <span class="op">=</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>  x3 <span class="op">=</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">high_cor_data</span>, threshold <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Error:"</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: No valid subsets found that satisfy the threshold constraint</span></span></code></pre></div>
<p><strong>Solutions</strong>: 1. Increase threshold 2. Use
<code>force_in</code> to keep at least one variable 3. Check data for
near-duplicates</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Solution 1: Increase threshold</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">high_cor_data</span>, threshold <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in corrPrune(high_cor_data, threshold = 0.95): No valid subsets found that satisfy the threshold constraint</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: object 'result' not found</span></span>
<span></span>
<span><span class="co"># Solution 2: Force keep one variable</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">high_cor_data</span>, threshold <span class="op">=</span> <span class="fl">0.5</span>, force_in <span class="op">=</span> <span class="st">"x1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in corrPrune(high_cor_data, threshold = 0.5, force_in = "x1"): No valid subsets found that satisfy the threshold constraint</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: object 'result' not found</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="error-force_in-variables-conflict-with-threshold">Error: force_in variables conflict with threshold<a class="anchor" aria-label="anchor" href="#error-force_in-variables-conflict-with-threshold"></a>
</h4>
<p><strong>Cause</strong>: Variables in <code>force_in</code> have
|correlation| &gt; threshold</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># x1 and x2 are highly correlated</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">high_cor_data</span>, threshold <span class="op">=</span> <span class="fl">0.5</span>, force_in <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Error:"</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Variables in 'force_in' violate the threshold constraint. Example: 'x1' and 'x2' have association 1.000 &gt; 0.500</span></span></code></pre></div>
<p><strong>Solution</strong>: Either increase threshold or reduce
<code>force_in</code> set</p>
</div>
<div class="section level4">
<h4 id="error-vif-computation-fails-in-modelprune">Error: VIF computation fails in modelPrune()<a class="anchor" aria-label="anchor" href="#error-vif-computation-fails-in-modelprune"></a>
</h4>
<p><strong>Cause</strong>: Perfect multicollinearity (R² = 1)</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create perfect multicollinearity</span></span>
<span><span class="va">perfect_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>  x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>  x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">perfect_data</span><span class="op">$</span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="va">perfect_data</span><span class="op">$</span><span class="va">x1</span> <span class="op">+</span> <span class="va">perfect_data</span><span class="op">$</span><span class="va">x2</span>  <span class="co"># Perfect collinearity</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/modelPrune.html">modelPrune</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">perfect_data</span>, limit <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Error:"</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in summary.lm(fit): essentially perfect fit: summary may be unreliable</span></span>
<span><span class="co">#&gt; Warning in summary.lm(fit): essentially perfect fit: summary may be unreliable</span></span>
<span><span class="co">#&gt; Warning in summary.lm(fit): essentially perfect fit: summary may be unreliable</span></span>
<span><span class="co">#&gt;               y          x1          x2</span></span>
<span><span class="co">#&gt; 1   -0.71524219 -0.07355602 -0.60189285</span></span>
<span><span class="co">#&gt; 2   -0.75268897 -1.16865142 -0.99369859</span></span>
<span><span class="co">#&gt; 3   -0.93853870 -0.63474826  1.02678506</span></span>
<span><span class="co">#&gt; 4   -1.05251328 -0.02884155  0.75106130</span></span>
<span><span class="co">#&gt; 5   -0.43715953  0.67069597 -1.50916654</span></span>
<span><span class="co">#&gt; 6    0.33117917 -1.65054654 -0.09514745</span></span>
<span><span class="co">#&gt; 7   -2.01421050 -0.34975424 -0.89594782</span></span>
<span><span class="co">#&gt; 8    0.21198043  0.75640644 -2.07075107</span></span>
<span><span class="co">#&gt; 9    1.23667505 -0.53880916  0.15012013</span></span>
<span><span class="co">#&gt; 10   2.03757402  0.22729192 -0.07921171</span></span>
<span><span class="co">#&gt; 11   1.30117599  0.49222857 -0.09736927</span></span>
<span><span class="co">#&gt; 12   0.75677476  0.26783502  0.21615254</span></span>
<span><span class="co">#&gt; 13  -1.72673040  0.65325768  0.88246516</span></span>
<span><span class="co">#&gt; 14  -0.60150671 -0.12270866  0.20559750</span></span>
<span><span class="co">#&gt; 15  -0.35204646 -0.41367651 -0.61643584</span></span>
<span><span class="co">#&gt; 16   0.70352390 -2.64314895 -0.73479925</span></span>
<span><span class="co">#&gt; 17  -0.10567133 -0.09294102 -0.13180279</span></span>
<span><span class="co">#&gt; 18  -1.25864863  0.43028470  0.31001699</span></span>
<span><span class="co">#&gt; 19   1.68443571  0.53539884 -1.03968035</span></span>
<span><span class="co">#&gt; 20   0.91139129 -0.55527835 -0.18430887</span></span>
<span><span class="co">#&gt; 21   0.23743027  1.77950291  0.96726726</span></span>
<span><span class="co">#&gt; 22   1.21810861  0.28642442 -0.10828009</span></span>
<span><span class="co">#&gt; 23  -1.33877429  0.12631586 -0.69842067</span></span>
<span><span class="co">#&gt; 24   0.66082030  1.27226678 -0.27594517</span></span>
<span><span class="co">#&gt; 25  -0.52291238 -0.71846622  1.11464855</span></span>
<span><span class="co">#&gt; 26   0.68374552 -0.45033862  0.55004396</span></span>
<span><span class="co">#&gt; 27  -0.06082195  2.39745248  1.23667580</span></span>
<span><span class="co">#&gt; 28   0.63296071  0.01112919  0.13909786</span></span>
<span><span class="co">#&gt; 29   1.33551762  1.63356842  0.41027510</span></span>
<span><span class="co">#&gt; 30   0.00729009 -1.43850664 -0.55845691</span></span>
<span><span class="co">#&gt; 31   1.01755864 -0.19051680  0.60537067</span></span>
<span><span class="co">#&gt; 32  -1.18843404  0.37842390 -0.50633354</span></span>
<span><span class="co">#&gt; 33  -0.72160444  0.30003855 -1.42056550</span></span>
<span><span class="co">#&gt; 34   1.51921771 -1.00563626  0.12799297</span></span>
<span><span class="co">#&gt; 35   0.37738797  0.01925927  1.94585122</span></span>
<span><span class="co">#&gt; 36  -2.05222282 -1.07742065  0.80091434</span></span>
<span><span class="co">#&gt; 37  -1.36403745  0.71270333  1.16525339</span></span>
<span><span class="co">#&gt; 38  -0.20078102  1.08477509  0.35885572</span></span>
<span><span class="co">#&gt; 39   0.86577940 -2.22498770 -0.60855718</span></span>
<span><span class="co">#&gt; 40  -0.10188326  1.23569346 -0.20224086</span></span>
<span><span class="co">#&gt; 41   0.62418747 -1.24104450 -0.27324811</span></span>
<span><span class="co">#&gt; 42   0.95900538  0.45476927 -0.46869978</span></span>
<span><span class="co">#&gt; 43   1.67105483  0.65990264  0.70416728</span></span>
<span><span class="co">#&gt; 44   0.05601673 -0.19988983 -1.19736350</span></span>
<span><span class="co">#&gt; 45  -0.05198191 -0.64511396  0.86636613</span></span>
<span><span class="co">#&gt; 46  -1.75323736  0.16532102  0.86415249</span></span>
<span><span class="co">#&gt; 47   0.09932759  0.43881870 -1.19862236</span></span>
<span><span class="co">#&gt; 48  -0.57185006  0.88330282  0.63949200</span></span>
<span><span class="co">#&gt; 49  -0.97400958 -2.05233698  2.43022665</span></span>
<span><span class="co">#&gt; 50  -0.17990623 -1.63637927 -0.55721548</span></span>
<span><span class="co">#&gt; 51   1.01494317  1.43040234  0.84490424</span></span>
<span><span class="co">#&gt; 52  -1.99274849  1.04662885 -0.78220185</span></span>
<span><span class="co">#&gt; 53  -0.42727929  0.43528895  1.11071142</span></span>
<span><span class="co">#&gt; 54   0.11663728  0.71517841  0.24982472</span></span>
<span><span class="co">#&gt; 55  -0.89320757  0.91717492  1.65191539</span></span>
<span><span class="co">#&gt; 56   0.33390294 -2.66092280 -1.45897073</span></span>
<span><span class="co">#&gt; 57   0.41142992  1.11027710 -0.05129789</span></span>
<span><span class="co">#&gt; 58  -0.03303616 -0.48498760 -0.52692518</span></span>
<span><span class="co">#&gt; 59  -2.46589819  0.23061683 -0.19726487</span></span>
<span><span class="co">#&gt; 60   2.57145815 -0.29515780 -0.62957874</span></span>
<span><span class="co">#&gt; 61  -0.20529926  0.87196495 -0.83384358</span></span>
<span><span class="co">#&gt; 62   0.65119328 -0.34847245  0.57872237</span></span>
<span><span class="co">#&gt; 63   0.27376649  0.51850377 -1.08758071</span></span>
<span><span class="co">#&gt; 64   1.02467323 -0.39068498  1.48403093</span></span>
<span><span class="co">#&gt; 65   0.81765945 -1.09278721 -1.18620659</span></span>
<span><span class="co">#&gt; 66  -0.20979317  1.21001051  0.10107915</span></span>
<span><span class="co">#&gt; 67   0.37816777  0.74090001  0.53298929</span></span>
<span><span class="co">#&gt; 68  -0.94540883  1.72426224  0.58673534</span></span>
<span><span class="co">#&gt; 69   0.85692301  0.06515393 -0.30174666</span></span>
<span><span class="co">#&gt; 70  -0.46103834  1.12500275  0.07950200</span></span>
<span><span class="co">#&gt; 71   2.41677335  1.97541905  0.96126415</span></span>
<span><span class="co">#&gt; 72  -1.65104890 -0.28148212 -1.45646592</span></span>
<span><span class="co">#&gt; 73  -0.46398724 -1.32295111 -0.78173971</span></span>
<span><span class="co">#&gt; 74   0.82537986 -0.23935157  0.32040231</span></span>
<span><span class="co">#&gt; 75   0.51013255 -0.21404124 -0.44478198</span></span>
<span><span class="co">#&gt; 76  -0.58948104  0.15168050  1.37000399</span></span>
<span><span class="co">#&gt; 77  -0.99678074  1.71230498  0.67325386</span></span>
<span><span class="co">#&gt; 78   0.14447570 -0.32614389  0.07216675</span></span>
<span><span class="co">#&gt; 79  -0.01430741  0.37300466 -1.50775732</span></span>
<span><span class="co">#&gt; 80  -1.79028124 -0.22768406  0.02610023</span></span>
<span><span class="co">#&gt; 81   0.03455107  0.02045071 -0.31641587</span></span>
<span><span class="co">#&gt; 82   0.19023032  0.31405766 -0.10234651</span></span>
<span><span class="co">#&gt; 83   0.17472640  1.32821470 -1.18155923</span></span>
<span><span class="co">#&gt; 84  -1.05501704  0.12131838  0.49865804</span></span>
<span><span class="co">#&gt; 85   0.47613328  0.71284232 -1.03895644</span></span>
<span><span class="co">#&gt; 86   1.37857014  0.77886003 -0.22622198</span></span>
<span><span class="co">#&gt; 87   0.45623640  0.91477327  0.38142583</span></span>
<span><span class="co">#&gt; 88  -1.13558847 -0.57439455 -0.78351579</span></span>
<span><span class="co">#&gt; 89  -0.43564547  1.62688121  0.58299141</span></span>
<span><span class="co">#&gt; 90   0.34610362 -0.38095674 -1.31651040</span></span>
<span><span class="co">#&gt; 91  -0.64704563 -0.10578417 -2.80977468</span></span>
<span><span class="co">#&gt; 92  -2.15764634  1.40405027  0.46496799</span></span>
<span><span class="co">#&gt; 93   0.88425082  1.29408391  0.84053983</span></span>
<span><span class="co">#&gt; 94  -0.82947761 -1.08999187 -0.28584542</span></span>
<span><span class="co">#&gt; 95  -0.57356027 -0.87307100  0.50412625</span></span>
<span><span class="co">#&gt; 96   1.50390061 -1.35807906 -1.15591653</span></span>
<span><span class="co">#&gt; 97  -0.77414493  0.18184719 -0.12714861</span></span>
<span><span class="co">#&gt; 98   0.84573154  0.16484087 -1.94151838</span></span>
<span><span class="co">#&gt; 99  -1.26068288  0.36411469  1.18118089</span></span>
<span><span class="co">#&gt; 100 -0.35454240  0.55215771  1.85991086</span></span></code></pre></div>
<p><strong>Solution</strong>: Use <code><a href="../reference/corrPrune.html">corrPrune()</a></code> first to
remove perfect collinearity:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Two-step approach</span></span>
<span><span class="va">step1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">perfect_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, threshold <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span>
<span><span class="va">step2_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">perfect_data</span><span class="op">$</span><span class="va">y</span>, <span class="va">step1</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelPrune.html">modelPrune</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">step2_data</span>, limit <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in summary.lm(fit): essentially perfect fit: summary may be unreliable</span></span>
<span><span class="co">#&gt; Warning in summary.lm(fit): essentially perfect fit: summary may be unreliable</span></span>
<span><span class="co">#&gt; Warning in summary.lm(fit): essentially perfect fit: summary may be unreliable</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"selected_vars"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "x1" "x2"</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="threshold-selection-guidance">5.2 Threshold Selection Guidance<a class="anchor" aria-label="anchor" href="#threshold-selection-guidance"></a>
</h3>
<div class="section level4">
<h4 id="for-corrprune-correlation-threshold">For corrPrune() (Correlation Threshold)<a class="anchor" aria-label="anchor" href="#for-corrprune-correlation-threshold"></a>
</h4>
<p><strong>Conservative (strict)</strong>:</p>
<ul>
<li>threshold = 0.5: Very low redundancy, may lose information</li>
<li>Use when: Interpretability is critical, small sample size</li>
</ul>
<p><strong>Moderate (recommended)</strong>:</p>
<ul>
<li>threshold = 0.7: Balances redundancy and information retention</li>
<li>Use when: Standard regression, general analysis</li>
</ul>
<p><strong>Lenient</strong>:</p>
<ul>
<li>threshold = 0.9: Only removes near-duplicates</li>
<li>Use when: Large sample size, prediction focus</li>
</ul>
</div>
<div class="section level4">
<h4 id="for-modelprune-vif-limit">For modelPrune() (VIF Limit)<a class="anchor" aria-label="anchor" href="#for-modelprune-vif-limit"></a>
</h4>
<p><strong>Strict</strong>:</p>
<ul>
<li>limit = 2: Very low multicollinearity, may over-prune</li>
<li>Use when: Small sample size, interpretability critical</li>
</ul>
<p><strong>Moderate (recommended)</strong>:</p>
<ul>
<li>limit = 5: Standard threshold in literature</li>
<li>Use when: General regression analysis</li>
</ul>
<p><strong>Lenient</strong>:</p>
<ul>
<li>limit = 10: Tolerates more multicollinearity</li>
<li>Use when: Large sample size, prediction focus</li>
</ul>
</div>
<div class="section level4">
<h4 id="empirical-approach-visualize-first">Empirical Approach: Visualize First<a class="anchor" aria-label="anchor" href="#empirical-approach-visualize-first"></a>
</h4>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize correlation distribution</span></span>
<span><span class="va">cor_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">cor_vec</span> <span class="op">&lt;-</span> <span class="va">cor_mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">upper.tri</a></span><span class="op">(</span><span class="va">cor_mat</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Histogram of correlations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">cor_vec</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">30</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Distribution of |Correlations|"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"|Correlation|"</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.9</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0.5 (strict)"</span>, <span class="st">"0.7 (moderate)"</span>, <span class="st">"0.9 (lenient)"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span>,</span>
<span>       bty <span class="op">=</span> <span class="st">"o"</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subset size vs threshold</span></span>
<span><span class="va">thresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.95</span>, by <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">sizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">thresholds</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">mtcars</span>, threshold <span class="op">=</span> <span class="va">t</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">thresholds</span>, <span class="va">sizes</span>, type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Threshold"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Number of Variables Retained"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Threshold Sensitivity"</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"blue"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>, <span class="st">"Original"</span>, pos <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>
<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='720.00pt' height='288.00pt' viewBox='0 0 720.00 288.00' class="r-plt inline-svg" style="max-width:100%;width:100%;height:auto;">
<g class='svglite'>
<defs>
  <style type='text/css'><![CDATA[
    /* theme-aware-processed */
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite circle {
      fill: none;
      stroke: #3E3F3A;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite > g > rect {
      fill: none;
      stroke: #3E3F3A;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
      fill: #3E3F3A;
    }
    .svglite g.glyphgroup path {
      fill: inherit;
      stroke: none;
    }
  ]]></style>
</defs>
<rect class='svg-bg' width='100%' height='100%' style='stroke: none; fill: #F5F6F8;'/>
<defs>
  <clipPath id='cpMC4wMHw3MjAuMDB8MC4wMHwyODguMDA='>
    <rect x='0.00' y='0.00' width='720.00' height='288.00' />
  </clipPath>
</defs>
<g clip-path='url(#cpMC4wMHw3MjAuMDB8MC4wMHwyODguMDA=)'>
</g>
<defs>
  <clipPath id='cpMC4wMHwzNjAuMDB8MC4wMHwyODguMDA='>
    <rect x='0.00' y='0.00' width='360.00' height='288.00' />
  </clipPath>
</defs>
<g clip-path='url(#cpMC4wMHwzNjAuMDB8MC4wMHwyODguMDA=)'>
<text x='194.40' y='34.67' text-anchor='middle' style='font-size: 14.40px; font-weight: bold; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='195.19px' lengthAdjust='spacingAndGlyphs'>Distribution of |Correlations|</text>
<text x='194.40' y='269.28' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='64.95px' lengthAdjust='spacingAndGlyphs'>|Correlation|</text>
<text transform='translate(12.96,136.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='56.69px' lengthAdjust='spacingAndGlyphs'>Frequency</text>
</g>
<g clip-path='url(#cpMC4wMHw3MjAuMDB8MC4wMHwyODguMDA=)'>
<line x1='110.84' y1='214.56' x2='277.96' y2='214.56' style='stroke-width: 0.75;' />
<line x1='110.84' y1='214.56' x2='110.84' y2='221.76' style='stroke-width: 0.75;' />
<line x1='166.55' y1='214.56' x2='166.55' y2='221.76' style='stroke-width: 0.75;' />
<line x1='222.25' y1='214.56' x2='222.25' y2='221.76' style='stroke-width: 0.75;' />
<line x1='277.96' y1='214.56' x2='277.96' y2='221.76' style='stroke-width: 0.75;' />
<text x='110.84' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.2</text>
<text x='166.55' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.4</text>
<text x='222.25' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.6</text>
<text x='277.96' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.8</text>
<line x1='59.04' y1='208.80' x2='59.04' y2='64.80' style='stroke-width: 0.75;' />
<line x1='59.04' y1='208.80' x2='51.84' y2='208.80' style='stroke-width: 0.75;' />
<line x1='59.04' y1='172.80' x2='51.84' y2='172.80' style='stroke-width: 0.75;' />
<line x1='59.04' y1='136.80' x2='51.84' y2='136.80' style='stroke-width: 0.75;' />
<line x1='59.04' y1='100.80' x2='51.84' y2='100.80' style='stroke-width: 0.75;' />
<line x1='59.04' y1='64.80' x2='51.84' y2='64.80' style='stroke-width: 0.75;' />
<text transform='translate(41.76,208.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='6.67px' lengthAdjust='spacingAndGlyphs'>0</text>
<text transform='translate(41.76,172.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='6.67px' lengthAdjust='spacingAndGlyphs'>2</text>
<text transform='translate(41.76,136.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='6.67px' lengthAdjust='spacingAndGlyphs'>4</text>
<text transform='translate(41.76,100.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='6.67px' lengthAdjust='spacingAndGlyphs'>6</text>
<text transform='translate(41.76,64.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='6.67px' lengthAdjust='spacingAndGlyphs'>8</text>
</g>
<defs>
  <clipPath id='cpNTkuMDR8MzI5Ljc2fDU5LjA0fDIxNC41Ng=='>
    <rect x='59.04' y='59.04' width='270.72' height='155.52' />
  </clipPath>
</defs>
<g clip-path='url(#cpNTkuMDR8MzI5Ljc2fDU5LjA0fDIxNC41Ng==)'>
<rect x='69.07' y='154.80' width='13.93' height='54.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='82.99' y='190.80' width='13.93' height='18.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='96.92' y='172.80' width='13.93' height='36.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='110.84' y='136.80' width='13.93' height='72.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='124.77' y='190.80' width='13.93' height='18.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='138.70' y='208.80' width='13.93' height='0.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='152.62' y='190.80' width='13.93' height='18.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='166.55' y='118.80' width='13.93' height='90.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='180.47' y='172.80' width='13.93' height='36.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='194.40' y='172.80' width='13.93' height='36.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='208.33' y='64.80' width='13.93' height='144.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='222.25' y='208.80' width='13.93' height='0.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='236.18' y='82.80' width='13.93' height='126.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='250.10' y='64.80' width='13.93' height='144.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='264.03' y='136.80' width='13.93' height='72.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='277.96' y='154.80' width='13.93' height='54.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='291.88' y='154.80' width='13.93' height='54.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<rect x='305.81' y='190.80' width='13.93' height='18.00' style='stroke-width: 0.75; fill: #ADD8E6;' />
<line x1='194.40' y1='214.56' x2='194.40' y2='59.04' style='stroke-width: 1.50; stroke: #FF0000; stroke-dasharray: 8.00,8.00;' />
<line x1='250.10' y1='214.56' x2='250.10' y2='59.04' style='stroke-width: 1.50; stroke: #0000FF; stroke-dasharray: 8.00,8.00;' />
<line x1='305.81' y1='214.56' x2='305.81' y2='59.04' style='stroke-width: 1.50; stroke: #00FF00; stroke-dasharray: 8.00,8.00;' />
<rect rx='4' x='202.47' y='59.04' width='127.29' height='57.60' style='stroke-width: 0.75; stroke: #DFD7CA; fill: #F5F6F8;' />
<line x1='213.27' y1='73.44' x2='234.87' y2='73.44' style='stroke-width: 1.50; stroke: #FF0000; stroke-dasharray: 8.00,8.00;' />
<line x1='213.27' y1='87.84' x2='234.87' y2='87.84' style='stroke-width: 1.50; stroke: #0000FF; stroke-dasharray: 8.00,8.00;' />
<line x1='213.27' y1='102.24' x2='234.87' y2='102.24' style='stroke-width: 1.50; stroke: #00FF00; stroke-dasharray: 8.00,8.00;' />
<text x='245.67' y='77.74' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='53.33px' lengthAdjust='spacingAndGlyphs'>0.5 (strict)</text>
<text x='245.67' y='92.14' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='78.69px' lengthAdjust='spacingAndGlyphs'>0.7 (moderate)</text>
<text x='245.67' y='106.54' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='63.36px' lengthAdjust='spacingAndGlyphs'>0.9 (lenient)</text>
</g>
<defs>
  <clipPath id='cpNDE5LjA0fDY4OS43Nnw1OS4wNHwyMTQuNTY='>
    <rect x='419.04' y='59.04' width='270.72' height='155.52' />
  </clipPath>
</defs>
<g clip-path='url(#cpNDE5LjA0fDY4OS43Nnw1OS4wNHwyMTQuNTY=)'>
<line x1='436.27' y1='208.80' x2='441.15' y2='208.80' style='stroke-width: 1.50; stroke: #0000FF;' />
<line x1='455.55' y1='208.80' x2='460.43' y2='208.80' style='stroke-width: 1.50; stroke: #0000FF;' />
<line x1='474.83' y1='208.80' x2='479.71' y2='208.80' style='stroke-width: 1.50; stroke: #0000FF;' />
<line x1='492.45' y1='204.20' x2='500.65' y2='197.40' style='stroke-width: 1.50; stroke: #0000FF;' />
<line x1='513.39' y1='192.80' x2='518.28' y2='192.80' style='stroke-width: 1.50; stroke: #0000FF;' />
<line x1='531.02' y1='188.20' x2='539.22' y2='181.40' style='stroke-width: 1.50; stroke: #0000FF;' />
<line x1='551.96' y1='176.80' x2='556.84' y2='176.80' style='stroke-width: 1.50; stroke: #0000FF;' />
<line x1='569.58' y1='172.20' x2='577.78' y2='165.40' style='stroke-width: 1.50; stroke: #0000FF;' />
<line x1='587.04' y1='154.63' x2='598.89' y2='134.97' style='stroke-width: 1.50; stroke: #0000FF;' />
<line x1='608.15' y1='124.20' x2='616.35' y2='117.40' style='stroke-width: 1.50; stroke: #0000FF;' />
<line x1='627.43' y1='108.20' x2='635.63' y2='101.40' style='stroke-width: 1.50; stroke: #0000FF;' />
<line x1='646.71' y1='92.20' x2='654.91' y2='85.40' style='stroke-width: 1.50; stroke: #0000FF;' />
<line x1='665.99' y1='76.20' x2='674.19' y2='69.40' style='stroke-width: 1.50; stroke: #0000FF;' />
<circle cx='429.07' cy='208.80' r='2.70' style='stroke-width: 1.50; stroke: #0000FF;' />
<circle cx='448.35' cy='208.80' r='2.70' style='stroke-width: 1.50; stroke: #0000FF;' />
<circle cx='467.63' cy='208.80' r='2.70' style='stroke-width: 1.50; stroke: #0000FF;' />
<circle cx='486.91' cy='208.80' r='2.70' style='stroke-width: 1.50; stroke: #0000FF;' />
<circle cx='506.19' cy='192.80' r='2.70' style='stroke-width: 1.50; stroke: #0000FF;' />
<circle cx='525.48' cy='192.80' r='2.70' style='stroke-width: 1.50; stroke: #0000FF;' />
<circle cx='544.76' cy='176.80' r='2.70' style='stroke-width: 1.50; stroke: #0000FF;' />
<circle cx='564.04' cy='176.80' r='2.70' style='stroke-width: 1.50; stroke: #0000FF;' />
<circle cx='583.32' cy='160.80' r='2.70' style='stroke-width: 1.50; stroke: #0000FF;' />
<circle cx='602.61' cy='128.80' r='2.70' style='stroke-width: 1.50; stroke: #0000FF;' />
<circle cx='621.89' cy='112.80' r='2.70' style='stroke-width: 1.50; stroke: #0000FF;' />
<circle cx='641.17' cy='96.80' r='2.70' style='stroke-width: 1.50; stroke: #0000FF;' />
<circle cx='660.45' cy='80.80' r='2.70' style='stroke-width: 1.50; stroke: #0000FF;' />
<circle cx='679.73' cy='64.80' r='2.70' style='stroke-width: 1.50; stroke: #0000FF;' />
</g>
<g clip-path='url(#cpMC4wMHw3MjAuMDB8MC4wMHwyODguMDA=)'>
<line x1='429.07' y1='214.56' x2='660.45' y2='214.56' style='stroke-width: 0.75;' />
<line x1='429.07' y1='214.56' x2='429.07' y2='221.76' style='stroke-width: 0.75;' />
<line x1='467.63' y1='214.56' x2='467.63' y2='221.76' style='stroke-width: 0.75;' />
<line x1='506.19' y1='214.56' x2='506.19' y2='221.76' style='stroke-width: 0.75;' />
<line x1='544.76' y1='214.56' x2='544.76' y2='221.76' style='stroke-width: 0.75;' />
<line x1='583.32' y1='214.56' x2='583.32' y2='221.76' style='stroke-width: 0.75;' />
<line x1='621.89' y1='214.56' x2='621.89' y2='221.76' style='stroke-width: 0.75;' />
<line x1='660.45' y1='214.56' x2='660.45' y2='221.76' style='stroke-width: 0.75;' />
<text x='429.07' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.3</text>
<text x='467.63' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.4</text>
<text x='506.19' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.5</text>
<text x='544.76' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.6</text>
<text x='583.32' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.7</text>
<text x='621.89' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.8</text>
<text x='660.45' y='240.48' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='16.67px' lengthAdjust='spacingAndGlyphs'>0.9</text>
<line x1='419.04' y1='208.80' x2='419.04' y2='80.80' style='stroke-width: 0.75;' />
<line x1='419.04' y1='208.80' x2='411.84' y2='208.80' style='stroke-width: 0.75;' />
<line x1='419.04' y1='176.80' x2='411.84' y2='176.80' style='stroke-width: 0.75;' />
<line x1='419.04' y1='144.80' x2='411.84' y2='144.80' style='stroke-width: 0.75;' />
<line x1='419.04' y1='112.80' x2='411.84' y2='112.80' style='stroke-width: 0.75;' />
<line x1='419.04' y1='80.80' x2='411.84' y2='80.80' style='stroke-width: 0.75;' />
<text transform='translate(401.76,208.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='6.67px' lengthAdjust='spacingAndGlyphs'>2</text>
<text transform='translate(401.76,176.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='6.67px' lengthAdjust='spacingAndGlyphs'>4</text>
<text transform='translate(401.76,144.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='6.67px' lengthAdjust='spacingAndGlyphs'>6</text>
<text transform='translate(401.76,112.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='6.67px' lengthAdjust='spacingAndGlyphs'>8</text>
<text transform='translate(401.76,80.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='13.34px' lengthAdjust='spacingAndGlyphs'>10</text>
<polygon points='419.04,214.56 689.76,214.56 689.76,59.04 419.04,59.04 ' style='stroke-width: 0.75;' />
</g>
<defs>
  <clipPath id='cpMzYwLjAwfDcyMC4wMHwwLjAwfDI4OC4wMA=='>
    <rect x='360.00' y='0.00' width='360.00' height='288.00' />
  </clipPath>
</defs>
<g clip-path='url(#cpMzYwLjAwfDcyMC4wMHwwLjAwfDI4OC4wMA==)'>
<text x='554.40' y='34.67' text-anchor='middle' style='font-size: 14.40px; font-weight: bold; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='145.56px' lengthAdjust='spacingAndGlyphs'>Threshold Sensitivity</text>
<text x='554.40' y='269.28' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='53.36px' lengthAdjust='spacingAndGlyphs'>Threshold</text>
<text transform='translate(372.96,136.80) rotate(-90)' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='159.84px' lengthAdjust='spacingAndGlyphs'>Number of Variables Retained</text>
</g>
<g clip-path='url(#cpNDE5LjA0fDY4OS43Nnw1OS4wNHwyMTQuNTY=)'>
<line x1='419.04' y1='64.80' x2='689.76' y2='64.80' style='stroke-width: 0.75; stroke: #BEBEBE; stroke-dasharray: 4.00,4.00;' />
<text x='429.07' y='57.60' text-anchor='middle' style='font-size: 12.00px; font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;' textLength='41.36px' lengthAdjust='spacingAndGlyphs'>Original</text>
</g>
</g>
</svg></p>
<p><strong>Strategy</strong>: Choose threshold where curve begins to
plateau.</p>
</div>
</div>
<div class="section level3">
<h3 id="handling-edge-cases">5.3 Handling Edge Cases<a class="anchor" aria-label="anchor" href="#handling-edge-cases"></a>
</h3>
<div class="section level4">
<h4 id="single-predictor-after-pruning">Single Predictor After Pruning<a class="anchor" aria-label="anchor" href="#single-predictor-after-pruning"></a>
</h4>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Very strict threshold may leave only 1 variable</span></span>
<span><span class="va">strict_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">mtcars</span>, threshold <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Variables remaining:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">strict_result</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Variables remaining: 2</span></span>
<span></span>
<span><span class="co"># Check if result is usable</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">strict_result</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Warning: Only 1 variable remaining. Consider:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  1. Increasing threshold\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  2. Using force_in to keep important variables\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="all-variables-removed">All Variables Removed<a class="anchor" aria-label="anchor" href="#all-variables-removed"></a>
</h4>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Impossible threshold</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">mtcars</span>, threshold <span class="op">=</span> <span class="fl">0.0</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Error:"</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: `threshold` must be in the range (0, 1].</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mixed-type-data">Mixed-Type Data<a class="anchor" aria-label="anchor" href="#mixed-type-data"></a>
</h4>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create mixed data</span></span>
<span><span class="va">mixed_data</span> <span class="op">&lt;-</span> <span class="va">mtcars</span></span>
<span><span class="va">mixed_data</span><span class="op">$</span><span class="va">cyl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mixed_data</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span></span>
<span><span class="va">mixed_data</span><span class="op">$</span><span class="va">am</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mixed_data</span><span class="op">$</span><span class="va">am</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use assocSelect for mixed types</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assocSelect.html">assocSelect</a></span><span class="op">(</span><span class="va">mixed_data</span>, threshold <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/methods/show.html" class="external-link">show</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; CorrCombo object</span></span>
<span><span class="co">#&gt; -----------------</span></span>
<span><span class="co">#&gt;   Method:      bron-kerbosch</span></span>
<span><span class="co">#&gt;   Correlation: mixed</span></span>
<span><span class="co">#&gt;   AssocMethod: numeric_factor = eta, numeric_numeric = pearson, factor_numeric</span></span>
<span><span class="co">#&gt;                = eta, factor_factor = cramersv</span></span>
<span><span class="co">#&gt;   Threshold:   0.600</span></span>
<span><span class="co">#&gt;   Subsets:     20 maximal subsets</span></span>
<span><span class="co">#&gt;   Data Rows:   32 used in correlation</span></span>
<span><span class="co">#&gt;   Pivot:       TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Top combinations:</span></span>
<span><span class="co">#&gt;   No.  Variables                          Avg    Max    Size</span></span>
<span><span class="co">#&gt;   ------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   [ 1] wt, vs, gear, carb                0.436  0.583     4</span></span>
<span><span class="co">#&gt;   [ 2] vs, am, carb                      0.265  0.570     3</span></span>
<span><span class="co">#&gt;   [ 3] wt, qsec, gear                    0.324  0.583     3</span></span>
<span><span class="co">#&gt;   [ 4] disp, carb, am                    0.348  0.591     3</span></span>
<span><span class="co">#&gt;   [ 5] drat, vs, carb                    0.367  0.570     3</span></span>
<span><span class="co">#&gt;   ... (15 more combinations)</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="best-practices">6. Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h2>
<div class="section level3">
<h3 id="workflow-recommendations">6.1 Workflow Recommendations<a class="anchor" aria-label="anchor" href="#workflow-recommendations"></a>
</h3>
<div class="section level4">
<h4 id="for-exploratory-analysis">For Exploratory Analysis<a class="anchor" aria-label="anchor" href="#for-exploratory-analysis"></a>
</h4>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Visualize correlations</span></span>
<span><span class="fu">corrplot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"circle"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Try multiple thresholds</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.9</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">data</span>, threshold <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Compare subset sizes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">results</span>, <span class="va">ncol</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Choose based on your needs</span></span>
<span><span class="va">final_data</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>  <span class="co"># threshold = 0.7</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="for-publication-quality-analysis">For Publication-Quality Analysis<a class="anchor" aria-label="anchor" href="#for-publication-quality-analysis"></a>
</h4>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Use exact mode for reproducibility and optimality</span></span>
<span><span class="va">data_pruned</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">data</span>, threshold <span class="op">=</span> <span class="fl">0.7</span>, mode <span class="op">=</span> <span class="st">"exact"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Document in methods section</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>  <span class="st">"Variables were pruned using corrselect::corrPrune() with threshold = 0.7, "</span>,</span>
<span>  <span class="st">"exact mode, retaining %d of %d original predictors."</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data_pruned</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Report which variables were removed</span></span>
<span><span class="va">removed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">data_pruned</span>, <span class="st">"removed_vars"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Removed variables:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">removed</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="combining-with-other-methods">6.2 Combining with Other Methods<a class="anchor" aria-label="anchor" href="#combining-with-other-methods"></a>
</h3>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Comprehensive variable selection pipeline</span></span>
<span><span class="va">pipeline</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">response</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Step 1: Remove correlations</span></span>
<span>  <span class="va">step1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/corrPrune.html">corrPrune</a></span><span class="op">(</span><span class="va">data</span>, threshold <span class="op">=</span> <span class="fl">0.7</span>, mode <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Step 2: VIF cleanup</span></span>
<span>  <span class="va">step2_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">response</span>, <span class="va">step1</span><span class="op">)</span></span>
<span>  <span class="va">step2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelPrune.html">modelPrune</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">step2_data</span>, limit <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Step 3: Feature importance (optional)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"Boruta"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">boruta_result</span> <span class="op">&lt;-</span> <span class="fu">Boruta</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Boruta/man/Boruta.html" class="external-link">Boruta</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">step2</span><span class="op">)</span></span>
<span>    <span class="va">important</span> <span class="op">&lt;-</span> <span class="fu">Boruta</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Boruta/man/getSelectedAttributes.html" class="external-link">getSelectedAttributes</a></span><span class="op">(</span><span class="va">boruta_result</span><span class="op">)</span></span>
<span>    <span class="va">final_data</span> <span class="op">&lt;-</span> <span class="va">step2</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"response"</span>, <span class="va">important</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">final_data</span> <span class="op">&lt;-</span> <span class="va">step2</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">final_data</span></span>
<span><span class="op">}</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="summary">7. Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<div class="section level3">
<h3 id="key-takeaways">Key Takeaways<a class="anchor" aria-label="anchor" href="#key-takeaways"></a>
</h3>
<div class="section level4">
<h4 id="algorithms">Algorithms<a class="anchor" aria-label="anchor" href="#algorithms"></a>
</h4>
<ul>
<li>Use <strong>exact mode</strong> for p ≤ 20 (optimal,
reproducible)</li>
<li>Use <strong>greedy mode</strong> for p &gt; 20 (fast,
near-optimal)</li>
<li>Use <strong>auto mode</strong> to let corrselect decide</li>
</ul>
</div>
<div class="section level4">
<h4 id="custom-engines">Custom Engines<a class="anchor" aria-label="anchor" href="#custom-engines"></a>
</h4>
<ul>
<li>Integrate any modeling package (INLA, mgcv, brms)</li>
<li>Define custom pruning criteria (AIC, BIC, p-values)</li>
<li>Two required functions: <code>fit</code> and
<code>diagnostics</code>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="optimization">Optimization<a class="anchor" aria-label="anchor" href="#optimization"></a>
</h4>
<ul>
<li>Precompute correlation matrices for multiple thresholds</li>
<li>Use greedy mode for large p</li>
<li>Parallelize across analyses, not within</li>
</ul>
</div>
<div class="section level4">
<h4 id="troubleshooting-1">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting-1"></a>
</h4>
<ul>
<li>Visualize correlation distribution before choosing threshold</li>
<li>Use <code>force_in</code> to protect important variables</li>
<li>Two-step pruning (corrPrune → modelPrune) for robustness</li>
</ul>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">8. References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p><strong>Algorithms</strong>:</p>
<ul>
<li>Eppstein, D., Löffler, M., &amp; Strash, D. (2010). Listing all
maximal cliques in sparse graphs in near-optimal time. <em>Symposium on
Algorithms and Computation</em>.</li>
<li>Bron, C., &amp; Kerbosch, J. (1973). Algorithm 457: Finding all
cliques of an undirected graph. <em>Communications of the ACM</em>,
16(9), 575-577.</li>
</ul>
<p><strong>Multicollinearity</strong>:</p>
<ul>
<li>O’Brien, R. M. (2007). A caution regarding rules of thumb for
variance inflation factors. <em>Quality &amp; Quantity</em>, 41(5),
673-690.</li>
<li>Belsley, D. A., Kuh, E., &amp; Welsch, R. E. (1980). <em>Regression
Diagnostics</em>. Wiley.</li>
</ul>
<p><strong>Software</strong>:</p>
<ul>
<li>INLA: Rue, H., Martino, S., &amp; Chopin, N. (2009). Approximate
Bayesian inference for latent Gaussian models. <em>Journal of the Royal
Statistical Society: Series B</em>, 71(2), 319-392.</li>
<li>mgcv: Wood, S. N. (2017). <em>Generalized Additive Models: An
Introduction with R</em> (2nd ed.). Chapman and Hall/CRC.</li>
</ul>
<hr>
<div class="section level3">
<h3 id="see-also">See Also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h3>
<ul>
<li>
<code><a href="../articles/quickstart.html">vignette("quickstart")</a></code> - 5-minute introduction</li>
<li>
<code><a href="../articles/workflows.html">vignette("workflows")</a></code> - Real-world examples</li>
<li>
<code><a href="../articles/comparison.html">vignette("comparison")</a></code> - vs caret, Boruta, glmnet</li>
<li>
<code>vignette("corrselect_vignette")</code> - Original exact
methods vignette</li>
<li>
<code><a href="../reference/corrPrune.html">?corrPrune</a></code> - Association-based pruning</li>
<li>
<code><a href="../reference/modelPrune.html">?modelPrune</a></code> - Model-based pruning</li>
<li>
<code><a href="../reference/corrSelect.html">?corrSelect</a></code> - Exact subset enumeration</li>
</ul>
</div>
<div class="section level3">
<h3 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h3>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31 ucrt)</span></span>
<span><span class="co">#&gt; Platform: x86_64-w64-mingw32/x64</span></span>
<span><span class="co">#&gt; Running under: Windows 11 x64 (build 26200)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt;   LAPACK version 3.12.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt; [1] LC_COLLATE=English_United States.utf8 </span></span>
<span><span class="co">#&gt; [2] LC_CTYPE=English_United States.utf8   </span></span>
<span><span class="co">#&gt; [3] LC_MONETARY=English_United States.utf8</span></span>
<span><span class="co">#&gt; [4] LC_NUMERIC=C                          </span></span>
<span><span class="co">#&gt; [5] LC_TIME=English_United States.utf8    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: Europe/Luxembourg</span></span>
<span><span class="co">#&gt; tzcode source: internal</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] microbenchmark_1.5.0 corrselect_3.0.2    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] digest_0.6.37     desc_1.4.3        R6_2.6.1          fastmap_1.2.0    </span></span>
<span><span class="co">#&gt;  [5] xfun_0.53         cachem_1.1.0      knitr_1.50        htmltools_0.5.8.1</span></span>
<span><span class="co">#&gt;  [9] rmarkdown_2.30    lifecycle_1.0.4   cli_3.6.5         svglite_2.2.2    </span></span>
<span><span class="co">#&gt; [13] sass_0.4.10       pkgdown_2.2.0     textshaping_1.0.3 jquerylib_0.1.4  </span></span>
<span><span class="co">#&gt; [17] systemfonts_1.3.1 compiler_4.5.2    tools_4.5.2       bslib_0.9.0      </span></span>
<span><span class="co">#&gt; [21] evaluate_1.0.5    Rcpp_1.1.0        yaml_2.3.10       jsonlite_2.0.0   </span></span>
<span><span class="co">#&gt; [25] rlang_1.1.6       fs_1.6.6          htmlwidgets_1.6.4 MASS_7.3-65</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gcol33" class="external-link">Gilles Colling</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
